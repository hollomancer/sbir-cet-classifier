# Security Audit - Tracked Files & Git History

**Date**: 2025-10-09
**Status**: üö® **CRITICAL SECURITY ISSUE FOUND**
**Remote**: None configured ‚úÖ (Not pushed to public repository)

---

## üö® CRITICAL: Exposed API Key in Git History

### Severity: HIGH

**File**: `.codex/auth.json`
**Commit**: `946cc8d` (adventures in vibecoding 1)
**Issue**: OpenAI API key tracked in git history

```json
{
  "OPENAI_API_KEY": "sk-svcacct-5oTE... [REDACTED]"
}
```

### Immediate Actions Required:

1. **REVOKE the OpenAI API key immediately** at https://platform.openai.com/api-keys
2. Generate a new API key
3. Store it securely (environment variable or secrets manager)
4. Remove from git history (see commands below)

### Why This Matters:

Even though there's no remote repository configured yet, this key:
- Could be exposed if you push to GitHub/GitLab
- Could be compromised if the repository is shared
- Could rack up charges if discovered and used
- Violates API key security best practices

---

## Files Currently Tracked (Should Be Removed)

### Category 1: AI Assistant Tool Files (69 files)

**Security Risk**: Medium (contains auth tokens, session data, command history)

#### `.codex/` - Codex Tool Files (40 files)
- `.codex/auth.json` ‚ö†Ô∏è **CRITICAL - Contains API key**
- `.codex/config.toml` - User configuration
- `.codex/history.jsonl` - Command history (~290KB)
- `.codex/log/codex-tui.log` - Application logs
- `.codex/sessions/` - 8 session files (development history)
- `.codex/prompts/` - 8 prompt files (speckit commands)
- `.codex/version.json` - Version info

#### `.claude/` - Claude Code Files (8 files)
- `.claude/commands/` - 8 command files (speckit commands)
- Note: `.claude/settings.local.json` is NOT tracked (good!)

#### `.gemini/` - Gemini AI Files (8 files)
- `.gemini/commands/` - 8 TOML command files (speckit commands)

#### `.amazonq/` - Amazon Q Files (8 files)
- `.amazonq/prompts/` - 8 prompt files (speckit commands)

#### `.github/prompts/` - GitHub Prompts (8 files)
- `.github/prompts/` - 8 prompt markdown files (speckit commands)

**Why Remove**: These files contain:
- User-specific configurations
- Authentication tokens (`.codex/auth.json` has API key!)
- Session histories with potential sensitive data
- Development artifacts that clutter the repository

---

### Category 2: Generated Data Files (3 files)

**Security Risk**: Low (just data bloat)

#### `data/processed/` - Processed Data (3 files)
- `data/processed/assessments.parquet` - Generated from CSV
- `data/processed/awards.parquet` - Generated from CSV
- `data/processed/taxonomy.parquet` - Generated from taxonomy

**Why Remove**: These are derived data files that can be regenerated from source:
- Created by running ingestion
- Large binary files (~MB each)
- Shouldn't be version controlled (only source data should be)

---

### Category 3: Generated Checklists (4 files)

**Security Risk**: None (just clutter)

#### `specs/001-i-want-to/checklists/` (4 files)
- `classification.md` - Generated checklist
- `ingestion.md` - Generated checklist
- `requirements.md` - Generated checklist
- `summary.md` - Generated checklist

**Why Remove**: These are generated by the speckit tools and shouldn't be tracked

---

### Category 4: Framework Files (.specify/)

**Security Risk**: Low (framework scaffolding)

#### `.specify/` - Specify Framework (12 files)
- `.specify/memory/constitution.md` - Project constitution
- `.specify/scripts/` - 5 bash scripts
- `.specify/templates/` - 5 template files

**Decision**: These are framework files. Keep or remove based on whether:
- **KEEP if**: Team uses speckit framework for feature development
- **REMOVE if**: These were just used for initial setup and aren't needed anymore

---

## Removal Strategy

### Option A: Nuclear Option (Clean Slate)

**When to use**: If repository hasn't been shared/pushed yet

```bash
# 1. REVOKE the API key at https://platform.openai.com/api-keys FIRST!

# 2. Remove all tracked sensitive files
git rm -r .codex/ .claude/commands/ .gemini/ .amazonq/ .github/prompts/
git rm -r data/processed/*.parquet
git rm -r specs/001-i-want-to/checklists/
git rm -r .specify/  # Optional

# 3. Commit the removal
git commit -m "Remove sensitive files and generated artifacts

- Remove AI assistant tool files (contains API key)
- Remove generated parquet files (can be regenerated)
- Remove generated checklists
- Update .gitignore to prevent future tracking"

# 4. Completely rewrite history to remove sensitive data
git filter-branch --force --index-filter \
  "git rm -r --cached --ignore-unmatch .codex/auth.json .codex/history.jsonl .codex/sessions/" \
  --prune-empty --tag-name-filter cat -- --all

# 5. Force garbage collection to remove orphaned data
rm -rf .git/refs/original/
git reflog expire --expire=now --all
git gc --prune=now --aggressive

# 6. Verify the key is gone
git log --all -- .codex/auth.json
# Should return nothing

# 7. Create new OpenAI API key and store securely
export OPENAI_API_KEY="your-new-key-here"
# Or add to ~/.bashrc, ~/.zshrc, or use a secrets manager
```

**Impact**: Completely removes sensitive data from git history

---

### Option B: Soft Removal (Keep History)

**When to use**: If you want to keep commit history

```bash
# 1. REVOKE the API key at https://platform.openai.com/api-keys FIRST!

# 2. Just stop tracking these files
git rm -r --cached .codex/ .claude/commands/ .gemini/ .amazonq/ .github/prompts/
git rm -r --cached data/processed/*.parquet
git rm -r --cached specs/001-i-want-to/checklists/
git rm -r --cached .specify/  # Optional

# 3. Commit
git commit -m "Stop tracking generated and sensitive files

Files are now in .gitignore and will no longer be tracked"

# 4. API key still exists in history, so don't push to public repo
```

**Warning**: API key still exists in old commits! Don't push to public repository without Option A.

---

### Option C: BFG Repo-Cleaner (Recommended for Large Repos)

**When to use**: Faster and safer than git filter-branch for large repositories

```bash
# 1. REVOKE the API key at https://platform.openai.com/api-keys FIRST!

# 2. Install BFG
brew install bfg  # macOS
# or download from https://rtyley.github.io/bfg-repo-cleaner/

# 3. Clone a fresh copy (backup)
cd ..
git clone --mirror sbir-cet-classifier sbir-cet-classifier-backup.git

# 4. Remove sensitive files from history
cd sbir-cet-classifier
bfg --delete-files auth.json
bfg --delete-folders .codex
bfg --delete-folders .gemini
bfg --delete-folders .amazonq

# 5. Clean up
git reflog expire --expire=now --all
git gc --prune=now --aggressive

# 6. Verify removal
git log --all -- .codex/auth.json
# Should return nothing
```

---

## Recommended Action Plan

### Step 1: Immediate Security Response (DO THIS NOW!)

```bash
# 1. REVOKE the OpenAI API key
# Go to: https://platform.openai.com/api-keys
# Find key starting with: sk-svcacct-5oTE...
# Click "Revoke" or "Delete"

# 2. Generate new API key and store securely
# Create new key at: https://platform.openai.com/api-keys
# Store in environment variable:
echo 'export OPENAI_API_KEY="your-new-key"' >> ~/.bashrc
# Or use a secrets manager like 1Password, AWS Secrets Manager, etc.
```

---

### Step 2: Clean Repository (After Revoking Key)

Since there's **no remote repository**, you can safely use Option A (Nuclear Option) to completely remove the API key from git history.

```bash
# Execute the commands from Option A above
```

---

### Step 3: Prevent Future Issues

**Updated .gitignore** ‚úÖ Already done!

```gitignore
# AI Assistant Tools
.claude/
.codex/
.gemini/
.amazonq/
.github/prompts/

# Data directories (generated/processed data)
data/raw/
data/processed/*.parquet
artifacts/*.jsonl
artifacts/*.json

# Specification/Planning tools
.specify/
```

**Best Practices**:
- ‚úÖ Never commit API keys, tokens, or credentials
- ‚úÖ Use environment variables for secrets
- ‚úÖ Use `.env.example` for environment variable templates
- ‚úÖ Keep .gitignore up to date
- ‚úÖ Run `git status` before committing to check for sensitive files

---

### Step 4: Create Environment Template

Create `.env.example` for future reference:

```bash
# Example environment variables (DO NOT put real values here)
OPENAI_API_KEY=your_api_key_here
SBIR_RAW_DIR=data/raw
SBIR_PROCESSED_DIR=data/processed
SBIR_ARTIFACT_DIR=artifacts
```

Then in `.gitignore`, add:
```
.env
```

---

## Summary Statistics

| Category | Files | Risk Level | Action |
|----------|-------|------------|--------|
| **Auth/Secrets** | 1 file | üö® **CRITICAL** | Revoke key + remove from history |
| **AI Tool Files** | 68 files | ‚ö†Ô∏è Medium | Remove from tracking |
| **Generated Data** | 3 files | ‚ÑπÔ∏è Low | Remove (can regenerate) |
| **Checklists** | 4 files | ‚ÑπÔ∏è Low | Remove (can regenerate) |
| **Framework** | 12 files | ‚ÑπÔ∏è Low | Optional (decide based on usage) |
| **TOTAL** | **88 files** | - | **Cleanup required** |

---

## After Cleanup Checklist

- [ ] Revoked old OpenAI API key ‚úÖ
- [ ] Generated new API key ‚úÖ
- [ ] Stored new key in environment variable ‚úÖ
- [ ] Removed `.codex/auth.json` from git history ‚úÖ
- [ ] Removed all AI tool files from tracking ‚úÖ
- [ ] Removed generated data files from tracking ‚úÖ
- [ ] Verified key not in `git log` ‚úÖ
- [ ] Tested that application still works ‚úÖ
- [ ] Verified .gitignore prevents future tracking ‚úÖ

---

## Future Safeguards

### Pre-commit Hook (Optional)

Create `.git/hooks/pre-commit`:

```bash
#!/bin/bash
# Prevent committing sensitive files

if git diff --cached --name-only | grep -E "(auth\.json|\.env$|api[_-]?key|secret|credential)"; then
    echo "‚ùå ERROR: Attempting to commit sensitive files!"
    echo "Files:"
    git diff --cached --name-only | grep -E "(auth\.json|\.env$|api[_-]?key|secret|credential)"
    exit 1
fi

exit 0
```

Make executable:
```bash
chmod +x .git/hooks/pre-commit
```

---

## Conclusion

**Critical**: API key exposure in `.codex/auth.json` requires immediate action:
1. ‚úÖ Revoke the key (do this first!)
2. ‚úÖ Remove from git history (use Option A)
3. ‚úÖ Generate new key and store securely
4. ‚úÖ Remove 88 files from tracking
5. ‚úÖ Verify .gitignore prevents future issues

**Good News**: No remote repository configured, so key hasn't been exposed publicly yet.

**Status After Cleanup**: Repository will be clean, secure, and ready for safe sharing or pushing to remote.

---

**Audit Date**: 2025-10-09
**Auditor**: Claude Code
**Priority**: üö® HIGH - Act immediately on API key revocation
